<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Easy loading and visualization of climate models • cavaR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Easy loading and visualization of climate models">
<meta property="og:description" content="A framework to work with multiple NetCDF files">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">cavaR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="cavar" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#cavar" class="anchor"></a>cavaR</h1></div>
<p>2022-11-01</p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>If you had hard times working with several netCDF files and perform
meaningful analysis, especially related to climate change, then this
package might be what you are looking for.</p>
<p>cavaR is the package version of <a href="https://github.com/Risk-Team/CAVA-Analytics">CAVA-Analytics</a>.
It allows easy loading of multiple climate models, both from local data
or remotely, through <a href="https://github.com/SantanderMetGroup/climate4R.UDG">climate4RUDG</a>.
cavaR can be seen as a wrapper of several packages, but the main engine
for loading and processing climate models is the <a href="https://github.com/SantanderMetGroup/climate4R">climate4R
framework</a>, applied with a tidyverse approach.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>The development version of cavaR can be installed directly from
github with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install_github</span>(<span class="st">"Risk-Team/cavaR"</span>)</span></code></pre></div>
<p>if you encounter problems with dependencies, such as loadeR,
downscaleR and climate4R.indices, follow the following instructions: <a href="https://github.com/SantanderMetGroup/loadeR">loadeR</a>, <a href="https://github.com/SantanderMetGroup/downscaleR">downscaleR</a>,
<a href="https://github.com/SantanderMetGroup/climate4R.indices">climate4R.indices</a></p>
<p>A conda environment will follow</p>
</div>
<div id="a-framework-to-work-with-climate-data-and-other-netcdf-files" class="section level2">
<h2 class="hasAnchor">
<a href="#a-framework-to-work-with-climate-data-and-other-netcdf-files" class="anchor"></a>A framework to work with climate data and other netCDF files</h2>
<p>cavaR makes it easier to work with a large number of climate or
impact model simulations (netCDF files) and perform meaningful analysis.
The idea behind cavaR is to first load the data (multiple models) and
then work with the output of the load_data with other
<strong>cavaR</strong> functions.</p>
<table class="table">
<colgroup><col width="100%"></colgroup>
<thead><tr class="header">
<th align="center"><img src="https://user-images.githubusercontent.com/40058235/199256415-ed32c42b-e2f8-48e0-b4fe-558de6612038.png" alt="Framework"></th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><em>cavaR framework</em></td>
</tr></tbody>
</table>
<div id="first-step-load-the-data-locally-or-from-remote-repository" class="section level3">
<h3 class="hasAnchor">
<a href="#first-step-load-the-data-locally-or-from-remote-repository" class="anchor"></a>First step: load the data (locally or from remote repository)</h3>
<div id="loading-data-load_data-function" class="section level4">
<h4 class="hasAnchor">
<a href="#loading-data-load_data-function" class="anchor"></a>Loading data: load_data function</h4>
<p><strong>cavaR</strong> simplifies and standardize how to load
multiple climate models/simulations or other netcdf files (e.g impact
models from ISIMIP). To <strong>load local data</strong>, specify the
path to your directories, containing, for example, several RCPs and a
folder with historical runs.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cavaR)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>exmp1 <span class="ot">&lt;-</span> <span class="fu">load_data</span>(<span class="at">country =</span> <span class="st">"Sudan"</span>, <span class="at">variable=</span><span class="st">"tasmax"</span>, <span class="at">years.hist=</span><span class="dv">2000</span>, <span class="at">years.proj=</span><span class="dv">2010</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">path.to.rcps =</span> <span class="st">"~/Databases/CORDEX-CORE/AFR-22"</span>, <span class="at">path.to.obs=</span><span class="st">"~/Databases/W5E5"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">local.data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 3 x 3</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">##   RCP        models_mbrs      obs             </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;      &lt;list&gt;           &lt;list&gt;          </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 historical &lt;named list [6]&gt; &lt;named list [4]&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 rcp26      &lt;named list [6]&gt; &lt;named list [4]&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 rcp85      &lt;named list [6]&gt; &lt;named list [4]&gt;</span></span></code></pre></div>
<p>In this case, the path.to.rcps contained the following list of
files:</p>
<table class="table">
<colgroup><col width="100%"></colgroup>
<thead><tr class="header">
<th align="center"><img src="https://user-images.githubusercontent.com/40058235/199230403-5d252400-e543-42ea-89bd-297d777ee6a4.png" alt="screnshot"></th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><em>When data is uploaded locally, path.to.rcps would
contain at least one folder called historical, containing the historical
simulation runs and one or more folders per RCP, SSP or other. Within
these folders, there can be multiple models or simulations that will be
loaded and checked for temporal consistency</em></td>
</tr></tbody>
</table>
<p>with a small subset of the CAS-22 domain, available with the
package</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fpath <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/"</span>, <span class="at">package=</span><span class="st">"cavaR"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>exmp1 <span class="ot">&lt;-</span> <span class="fu">load_data</span>(<span class="at">country =</span> <span class="st">"Moldova"</span>, <span class="at">variable=</span><span class="st">"hurs"</span>, <span class="at">years.hist=</span><span class="dv">2000</span>, <span class="at">years.proj=</span><span class="dv">2010</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">path.to.rcps =</span> fpath)</span></code></pre></div>
<p><strong>To load CORDEX-CORE data stored remotely</strong>, set
path.to.rcps to “CORDEX-CORE” and specify the domain. For example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>remote.data <span class="ot">&lt;-</span> <span class="fu">load_data</span>(<span class="at">country =</span> <span class="st">"Sudan"</span>, <span class="at">variable=</span><span class="st">"tasmax"</span>, <span class="at">years.hist=</span><span class="dv">1995</span><span class="sc">:</span><span class="dv">2000</span>, <span class="at">years.proj=</span><span class="dv">2050</span><span class="sc">:</span><span class="dv">2060</span>,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">path.to.rcps =</span> <span class="st">"CORDEX-CORE"</span>, <span class="at">path.to.obs=</span><span class="st">"W5E5"</span>, <span class="at">domain=</span><span class="st">"AFR-22"</span>)</span></code></pre></div>
</div>
</div>
<div id="second-step-perform-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#second-step-perform-analysis" class="anchor"></a>Second step: perform analysis</h3>
<p>The second step is the most dynamic step of the cavaR framework.</p>
<p>After loading the data, regardless of whether the files are climate
models or impact models, you now have a tidy tibble with list column and
you can apply all of the tidyverse functions. One of the
<strong>cavaR</strong> functions is called <strong>projections</strong>.
As the name gives away, this function is used to calculate indexes and
other statistics on future data. It is also possible to perform
bias-correction if observed data has been loaded (e.g W5E5). In this
example we will use one of the several functions available in cavaR (at
the moment, only projections).</p>
<p>type ?projections to better understand what analysis can be performed
with this function. It returns a RasterStack</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="co"># operations are performed for each model separately and then an ensemble mean is made</span>
<span class="va">rsts</span> <span class="op">&lt;-</span> <span class="va">local.data</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="reference/projections.html">projections</a></span><span class="op">(</span>bias.correction <span class="op">=</span> <span class="cn">F</span>, season <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, uppert<span class="op">=</span><span class="cn">NULL</span>, lowert <span class="op">=</span> <span class="cn">NULL</span>, consecutive <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2022-11-18 16:04:30 projections, season 1-2-3-4-5-6-7-8-9-10-11-12. Calculation of mean  tasmax</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculating number of days above 42 C, which is equal to 315 Kelvin</span>
<span class="va">rsts_thrs</span> <span class="op">&lt;-</span> <span class="va">local.data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/projections.html">projections</a></span><span class="op">(</span>bias.correction <span class="op">=</span> <span class="cn">F</span>, season <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, uppert <span class="op">=</span> <span class="fl">315.15</span>, lowert <span class="op">=</span> <span class="cn">NULL</span>, consecutive <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2022-11-18 16:04:45 projections, season 1-2-3-4-5-6-7-8-9-10-11-12. Calculation of number of days with tasmax above threshold of 315.15</span></span></code></pre></div>
</div>
<div id="third-step-visualize-results" class="section level3">
<h3 class="hasAnchor">
<a href="#third-step-visualize-results" class="anchor"></a>Third step: visualize results</h3>
<p>After performing the required analysis, it is sufficient to call the
plotting function to visualize the results</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rsts</span> <span class="op">%&gt;%</span>
<span class="fu"><a href="reference/plotting.html">plotting</a></span><span class="op">(</span>plot_titles <span class="op">=</span> <span class="st">"Average tasmax (K)"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2022-11-18 16:05:00 Done</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-4-1.png"><!-- --></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rsts_thrs</span> <span class="op">%&gt;%</span>
<span class="fu"><a href="reference/plotting.html">plotting</a></span><span class="op">(</span>plot_titles <span class="op">=</span> <span class="st">"N. days"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2022-11-18 16:05:01 Done</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-4-2.png"><!-- --></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a> | <a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Riccardo Soldan <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Riccardo Soldan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
